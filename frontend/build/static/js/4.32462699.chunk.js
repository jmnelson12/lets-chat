(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{109:function(e,t){},112:function(e,t,a){},116:function(e,t,a){"use strict";a.r(t);var s=a(7),n=a(8),r=a(10),c=a(9),o=a(11),i=a(3),u=a(0),l=a.n(u),d=a(12),m=a(2),g=a.n(m),p=a(4),h=a(5),f=a.n(h),v=function(){var e=Object(p.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={success:!1,message:"",payload:null},t||(a.success=!1,a.message="No user token found"),e.prev=2,e.next=5,f.a.get("/user/getUser?token="+t);case 5:a.payload=e.sent,a.success=!0,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),a.success=!1,a.message="Error calling userGet api endpoint";case 13:return e.abrupt("return",Promise.resolve(a));case 14:case"end":return e.stop()}},e,null,[[2,9]])}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(p.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={success:!1,message:"",payload:null},t||(a.message="No chatId given"),e.prev=2,e.next=5,f.a.get("/user/getMessages?cid="+t);case 5:a.payload=e.sent,a.success=!0,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),a.message="Error calling getMessages api endpoint";case 12:return e.abrupt("return",Promise.resolve(a));case 13:case"end":return e.stop()}},e,null,[[2,9]])}));return function(t){return e.apply(this,arguments)}}(),w=a(83),k=a.n(w)()("/"),y=(a(112),function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(n.a)(t,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("h2",null,"Hello, ",this.props.data.firstName))}}]),t}(u.Component)),E=(u.Component,function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(c.a)(t).call(this,e))).state={newMessage:"",currentRoom:"General"},a}return Object(o.a)(t,e),Object(n.a)(t,[{key:"render",value:function(){var e=this,t=this.state.currentRoom,a=this.props,s=a.messages,n=a.userData;return l.a.createElement("div",null,l.a.createElement("div",{className:"message-room"},t),l.a.createElement("div",{className:"messages inset-shadow"},s.map(function(e,t){return l.a.createElement("div",{className:"message",key:t},n==={}?"Anon: ".concat(e.message):"".concat(e.userInfo.firstName," ").concat(e.userInfo.lastName,": ").concat(e.message))})),l.a.createElement("div",{className:"message-input inset-shadow"},l.a.createElement("input",{type:"text",onChange:function(t){return e.setState({newMessage:t.target.value})},onKeyDown:function(t){13===t.keyCode&&(e.props.handleSend(e.state.newMessage),e.setState({newMessage:""}))},value:this.state.newMessage,placeholder:"Enter Message..."}),l.a.createElement("button",{onClick:function(t){e.props.handleSend(e.state.newMessage),e.setState({newMessage:""})}},"Send")))}}]),t}(u.Component));a.d(t,"default",function(){return O});var O=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(c.a)(t).call(this,e))).state={messages:[],userData:{},senderData:{},errorMessage:""},a.handleSend=a.handleSend.bind(Object(i.a)(Object(i.a)(a))),a.socketReceiver=a.socketReceiver.bind(Object(i.a)(Object(i.a)(a))),a}return Object(o.a)(t,e),Object(n.a)(t,[{key:"componentDidMount",value:function(){var e=this;v(this.props.loginToken).then(function(t){var a,s=t.payload.data.payload;t.success||e.setState({errorMessage:"Error grabbing user data"}),e.setState({errorMessage:"",userData:s}),a=e.state.userData,k.emit("userConnected",a)}),b("12345").then(function(t){t.success||e.setState({errorMessage:"Error grabbing messages"});var a=t.payload.data.payload.map(function(e){return{message:e.message,timestamp:e.timestamp,userInfo:e.userInfo}});e.setState({messages:a})}),this.socketReceiver(),window.onfocus=function(){-1!==window.document.title.indexOf("New Message")&&(window.document.title="Lets Chat")}}},{key:"handleSend",value:function(e){if(e){var t={message:e,token:this.props.loginToken,chatRoomId:"12345",senderInfo:this.state.userData};s=t,k.emit("sentMessage",s);var a=this.state.messages.concat({message:e,userInfo:this.state.userData});console.log(a),this.setState({messages:a})}var s}},{key:"socketReceiver",value:function(){var e=this,t=this;new Promise(function(e,t){k.on("newMessage",function(t){e({type:"newMessage",data:t})}),k.on("newConnection",function(t){e({type:"userConnected",user:t})}),k.on("userDisconnected",function(t){e({type:"userDisconnected",user:t})})}).then(function(a){switch(a.type){case"newMessage":var s=e.state.messages.concat({message:a.data.message,userInfo:a.data.senderInfo});e.setState({messages:s}),window.document.title="Lets Chat - New Message",t.socketReceiver();break;case"userConnected":case"userDisconnected":console.log(a),t.socketReceiver();break;default:window.document.title="Lets Chat"}})}},{key:"render",value:function(){var e=this,t=this.state,a=t.userData,s=t.errorMessage,n=t.messages;return l.a.createElement("div",{className:"dashboard"},l.a.createElement("div",{className:"left-panel panel"},l.a.createElement("div",{className:"user-info inset-shadow"},l.a.createElement("button",{className:"btn-logout",onClick:function(){var t;e.props.removeToken(),t=e.state.userData,k.emit("userDisconnected",t),Object(d.b)(e.props.loginToken)}},"Logout"),l.a.createElement(y,{data:a}),l.a.createElement("h2",{className:"dashboard-error-message"},s)),l.a.createElement("div",{className:"chatRoom inset-shadow"})),l.a.createElement("div",{className:"right-panel panel"},l.a.createElement("div",{className:"panelHeader"}),l.a.createElement("div",{className:"messageBoard"},l.a.createElement(E,{messages:n,userData:a,handleSend:this.handleSend}))))}}]),t}(u.Component)}}]);
//# sourceMappingURL=4.32462699.chunk.js.map